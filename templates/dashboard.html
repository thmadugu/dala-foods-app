<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Dala Foods</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('dashboard') }}">Dala Foods</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('production') }}">Production</a></li>
        {% if role in ["Storekeeper", "Admin"] %}
        <li class="nav-item"><a class="nav-link" href="{{ url_for('store') }}">Store</a></li>
        {% endif %}
        {% if role == "Admin" %}
        <li class="nav-item"><a class="nav-link" href="{{ url_for('manage_staff') }}">Manage Staff</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('export_production') }}">Export</a></li>
        {% endif %}
        <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container my-4">
    <h2>Welcome, {{ email }}!</h2>
    <h5>Role: {{ role }}</h5>
    
    {% if low_stock %}
    <div class="alert alert-warning mt-3" role="alert">
      ⚠️ Low Stock Alert: 
      {% for item in low_stock %}
        {{ item }}{% if not loop.last %}, {% endif %}
      {% endfor %}
    </div>
    {% endif %}
    
    <div class="row mt-4">
        <div class="col-12 col-md-6 mb-3">
            <div class="card p-3">
                <h5>Production Overview</h5>
                <canvas id="productionChart"></canvas>
            </div>
        </div>
        <div class="col-12 col-md-6 mb-3">
            <div class="card p-3">
                <h5>Store Inventory</h5>
                <canvas id="storeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
const prodCtx = document.getElementById('productionChart').getContext('2d');
const productionChart = new Chart(prodCtx, {
    type: 'bar',
    data: {
        labels: {{ prod_labels | tojson }},
        datasets: [{
            label: 'Total Produced Quantity',
            data: {{ prod_values | tojson }},
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: { responsive: true }
});

const storeCtx = document.getElementById('storeChart').getContext('2d');
const storeChart = new Chart(storeCtx, {
    type: 'pie',
    data: {
        labels: {{ store_labels | tojson }},
        datasets: [{
            label: 'Current Stock Quantity',
            data: {{ store_values | tojson }},
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)'
            ]
        }]
    },
    options: { responsive: true }
});
</script>
</body>
</html>
